<div class="row">
<div class="col-md-12">
<spinner name="tacticExecutionSpinner" ng-cloak>
    <div class="tactic-spinner-background"></div>
    <div class="tactic-spinner-overlay">
    <div class="tactic-spinner">
        <div class="spinner-double-bounce1"></div>
        <div class="spinner-double-bounce2"></div>
    </div>
    <div class="tactic-spinner-please-wait">
        <p>Tactic is executing, please wait...</p>
        <p><button class="btn btn-default" ng-click="runningTask.stop()"><i class="fa fa-stop"></i> Stop</button></p>
    </div>
    </div>
</spinner>
<spinner name="magnifyingglassSpinner" ng-cloak>
    <div class="tactic-spinner-background"></div>
    <div class="tactic-spinner-overlay">
        <div class="tactic-spinner">
            <div class="spinner-double-bounce1"></div>
            <div class="spinner-double-bounce2"></div>
        </div>
        <div class="tactic-spinner-please-wait">
            <p>Computing details, please wait...</p>
            <p><button class="btn btn-default" ng-click="runningTask.stop()"><i class="fa fa-stop"></i> Stop</button></p>
        </div>
    </div>
</spinner>
<spinner name="proofLoadingSpinner" ng-cloak>
    <div class="spinner-overlay"></div>
    <div class="spinner">
        <div class="spinner-double-bounce1"></div>
        <div class="spinner-double-bounce2"></div>
    </div>
    <div class="spinner-please-wait">Proof is loading, please wait...</div>
</spinner>
<spinner name="counterExampleSpinner" ng-cloak>
    <div class="spinner-overlay"></div>
    <div class="spinner">
        <div class="spinner-double-bounce1"></div>
        <div class="spinner-double-bounce2"></div>
    </div>
    <div class="spinner-please-wait">
        Searching for counterexample, please wait...<br/>
        <!--<button class="btn btn-default" ng-click="runningTask.stop()"><i class="fa fa-stop"></i> Stop</button>-->
    </div>
</spinner>
<div>
<div  ng-controller="TaskCtrl">
<div class="row">
    <div class="col-md-12">
        <!-- Tool box -->
        <div class="navbar navbar-default">
            <div class="navbar-inner">
            <div class="container-fluid">
                <span class="brand navbar-brand">
                    <span editable-text="proofName" onbeforesave="saveProofName($data)">
                        {{proofName}}
                    </span>
                </span>
                <div class="nav">
                    <ul class="nav navbar-nav" id="provingautomation">
                        <li><a ng-click="doTactic(undefined, 'master')"
                               data-intro="Automatic search" data-position="top"><span class="fa fa-play"> Auto</span></a></li>
                        <li><a ng-click="doTactic(undefined, 'unfold')"
                               data-intro="Unfold all operators" data-position="top"><span class="fa fa-map-o"> Unfold</span></a></li>
                        <li><a ng-click="onTacticScript('prop;done',false)"
                               data-intro="Automatic propositional search" data-position="top"><span class="fa fa-magic"> Prop-Auto</span></a></li>
                        <li><a ng-click="doTactic(undefined, 'fullSimplify')"
                               data-intro="Simplify formulas" data-position="top"><span class="fa fa-compress"> Simplify</span></a></li>
                        <li><a ng-click="undoLastStep()"
                               data-intro="Undo" data-position="top"><span class="fa fa-undo"> Step back</span></a></li>
                        <li><a ng-click="setFormulaMode('edit')" ng-if="getFormulaMode()=='prove'"
                               data-intro="Switch edit/prove" data-position="top"><i class="fa fa-pencil"></i> Edit</a></li>
                        <li class="active"><a ng-click="setFormulaMode('prove')" ng-if="getFormulaMode()=='edit'">
                            <i ng-class="{'fa':true, 'fa-pencil': !stickyEdit(), 'fa-pencil-square': stickyEdit()}"
                               uib-tooltip="Toggle to stay in edit mode"
                               ng-click="$event.stopPropagation();setStickyEdit(!stickyEdit())"></i> Edit</a>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav pull-right">
                        <li><a ng-click="isNavbarCollapsed=!isNavbarCollapsed"><span class="fa fa-bars"></span></a></li>
                    </ul>
                </div>
                <div class="nav-collapse" uib-collapse="isNavbarCollapsed">
                    <ul class="nav navbar-nav" id="provingbasictactics"
                        data-intro="Basic tactics for propositional reasoning, hybrid programs, differential equations, and arithmetic."
                        data-position="right">
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">Propositional <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a ng-click="doTactic(undefined, 'prop')"><span>Exhaustive</span><code class="pull-right">prop</code></a></li>
                                <li><a ng-click="openInputTacticDialog('cut', undefined)"><span>Cut ...</span><code class="pull-right">cut</code></a></li>
                                <li role="separator" class="divider"></li>
                                <li><a ng-click="doSearch('notR', 'R')"><span>&not;R</span><code class="pull-right">notR</code></a></li>
                                <li><a ng-click="doSearch('notL', 'L')"><span>&not;L</span><code class="pull-right">notL</code></a></li>
                                <li><a ng-click="doSearch('andR', 'R')"><span>&and;R</span><code class="pull-right">andR</code></a></li>
                                <li><a ng-click="doSearch('andL', 'L')"><span>&and;L</span><code class="pull-right">andL</code></a></li>
                                <li><a ng-click="doSearch('orR', 'R')"><span>&or;R</span><code class="pull-right">orR</code></a></li>
                                <li><a ng-click="doSearch('orL', 'L')"><span>&or;L</span><code class="pull-right">orL</code></a></li>
                                <li><a ng-click="doSearch('implyR', 'R')"><span>&#8594;R</span><code class="pull-right">implyR</code></a></li>
                                <li><a ng-click="doSearch('implyL', 'L')"><span>&#8594;L</span><code class="pull-right">implyL</code></a></li>
                                <li><a ng-click="doSearch('equivR', 'R')"><span>&#8596;R</span><code class="pull-right">equivR</code></a></li>
                                <li><a ng-click="doSearch('equivL', 'L')"><span>&#8596;L</span><code class="pull-right">equivL</code></a></li>
                                <li role="separator" class="divider"></li>
                                <!-- do not pull-right longest label: pulling right results in a line break here -->
                                <li><a ng-click="doSearch('commuteEquivR', 'R')"><span>&#8596;CR</span><code>commuteEquivR</code></a></li>
                                <li><a ng-click="doSearch('commuteEquivL', 'L')"><span>&#8596;CL</span><code>commuteEquivL</code></a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false" disabledtooltip="First-order Logic">Quantifiers <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a ng-click="doSearch('allR', 'R')"><span>&forall;R</span><code class="pull-right">allR</code></a></li>
                                <li><a ng-click="doSearch('existsL', 'R')"><span>&exist;L</span><code class="pull-right">existsL</code></a></li>
                                <!--<li role="separator" class="divider"></li>-->
                                <!--<li><a ng-click="doSearch('min', 'R')"><span>min</span><code class="pull-right">min</code></a></li>-->
                                <!--<li><a ng-click="doSearch('max', 'R')"><span>max</span><code class="pull-right">max</code></a></li>-->
                                <!--<li><a ng-click="doSearch('abs', 'R')"><span>abs</span><code class="pull-right">abs</code></a></li>-->
                                <!-- TODO -->
                                <!--<li role="separator" class="divider"></li>-->
                                <!--<li><a ng-click="doSearch('*0', 'L')"><span>&times;0</span><code class="pull-right">*0</code></a></li>-->
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">Hybrid Programs <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a ng-click="doSearch('chase', 'R')"><span>Exhaustive</span><code class="pull-right">chase</code></a></li>
                                <li role="separator" class="divider"></li>
                                <li><a ng-click="doSearch('assignb', 'R')"><span>[:=]</span><code class="pull-right">assignb</code></a></li>
                                <li><a ng-click="doSearch('randomb', 'R')"><span>[:*]</span><code class="pull-right">randomb</code></a></li>
                                <li><a ng-click="doSearch('testb', 'R')"><span>[?]</span><code class="pull-right">testb</code></a></li>
                                <li role="separator" class="divider"></li>
                                <li><a ng-click="doSearch('choiceb', 'R')"><span>[&cup;]</span><code class="pull-right">choiceb</code></a></li>
                                <li><a ng-click="doSearch('composeb', 'R')"><span>[;]</span><code class="pull-right">composeb</code></a></li>
                                <li role="separator" class="divider"></li>
                                <li><a ng-click="doSearch('boxAnd', 'R')"><span>[]&and;</span><code class="pull-right">boxAnd</code></a></li>
                                <li><a ng-click="doSearch('GV', 'R')"><span>Abstract</span><code>GV</code></a></li>
                                <li><a ng-click="openInputTacticDialog('MR', 'R')"><span>Generalize ...</span><code class="pull-right">MR</code></a></li>
                                <li role="separator" class="divider"></li>
                                <li><a ng-click="openInputTacticDialog('discreteGhost', 'R')"><span>Discrete ghost ...</span><code class="pull-right">discreteGhost</code></a></li>
                                <!-- TODO -->
                                <!--<li role="separator" class="divider"></li>-->
                                <!--<li><a ng-click="doSearch('DiamondCompose', 'R')"><span>&lang;;&rang;</span><code class="pull-right">composed</code></a></li>-->
                                <!--<li><a ng-click="doSearch('DiamondChoice', 'R')"><span>&rang;++&lang;</span><code class="pull-right">choiced</code></a></li>-->
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">Differential Equations <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a ng-click="doSearch('solve', 'R')"><span>Solve</span><code class="pull-right">solve</code></a></li>
                                <li><a ng-click="doSearch('dW', 'R')"><span>Weaken</span><code class="pull-right">dW</code></a></li>
                                <li><a ng-click="doSearch('dI', 'R')"><span>Diff. Invariant</span><code class="pull-right">dI</code></a></li>
                                <!-- TODO list further tactics -->
                                <!--<li><a ng-click="doSearch('DEs', 'R')"><span>Diff. Effect</span><code class="pull-right">DEs</code></a></li>-->
                                <!--<li><a ng-click="doSearch('Dassignb', 'R')"><span>Diff. Assign</span><code class="pull-right">Dassignb</code></a></li>-->
                                <li><a ng-click="openInputTacticDialog('dC', 'R')"><span>Diff. Cut ...</span><code class="pull-right">dC</code></a></li>
                                <li><a ng-click="openInputTacticDialog('dG', 'R')"><span>Diff. Ghost ...</span><code class="pull-right">dG</code></a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">Closing <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a ng-click="doTactic(undefined, 'closeId')"><span>Identity</span><code class="pull-right">closeId</code></a></li>
                                <li><a ng-click="doTactic(undefined, 'closeTrue')"><span>True</span><code class="pull-right">closeTrue</code></a></li>
                                <li><a ng-click="doTactic(undefined, 'closeFalse')"><span>False</span><code class="pull-right">closeFalse</code></a></li>
                                <li><a ng-click="doTactic(undefined, 'QE')"><span>Real arithmetic</span><code class="pull-right">QE</code></a></li>
                                <li><a ng-click="doTactic(undefined, 'smartQE')"><span>Smart arithmetic</span><code class="pull-right">smartQE</code></a></li>
                                <!-- TODO -->
                            </ul>
                        </li>
                        <li class="dropdown" id="provingadditionaltools">
                            <a class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">Inspect <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a ng-click="getCounterExample()">Counterexample</a></li>
                                <li><a ng-click="simulate()">Simulate</a></li>
                                <li><a ng-click="doTactic(undefined, 'pQE')">Find assumptions</a></li>
                                <li><a ng-click="exportSubgoal()">Export current subgoal</a></li>
                                <li><a ng-click="downloadProblemSolution()">Download proof</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="nav">
                    <ul class="nav navbar-nav">
                        <li ng-controller="ProofMessagesCtrl">
                            <k4-auto-hide-alert message="proofMessage.text"
                                                causeMsg="proofMessage.causeMsg"
                                                details="proofMessage.details"
                                                task-stepwise-request="proofMessage.taskStepwiseRequest"
                                                is-visible="proofMessage.isVisible" timeout="-1">
                            </k4-auto-hide-alert>
                        </li>

                    </ul>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <!-- TODO restrict to < 10 tasks as tabs, then complement the rest with dropdown -->
        <uib-tabset justified="true" active="agenda.selectedTab">
            <uib-tab ng-repeat="task in agenda.items() track by task.id" index="task.id"
                     deselect="agenda.deselect(task)" select="agenda.select(task)">
                <uib-tab-heading>
                    <!-- ng-class={'fa fa-tasks':openGoal, 'fa fa-check-square-o':closedGoal} -->
                    <!--<span class="fa fa-tasks"> {{task.goalLabel}}</span>-->
                    <div class="row">
                        <div class="col-md-11" ng-if="$first"
                             data-intro="Each unfinished subgoal of a proof is displayed on its own tab, which shows the current open proof goal at the top. Hover over formulas for tactic advice. Left-click to apply default, right-click for a list of tactics. Hover over &#8866; for tactics that transform the entire subgoal."
                             data-position="bottom">
                            <span class="fa fa-tasks"></span>
                            <!-- have to use blur, because editable doesn't work with uib-tabs in any other way -->
                            <span ng-if="task.isSelected" ng-cloak editable-text="task.name"
                                  onbeforesave="saveTaskName($data)" buttons="no" blur="submit">
                                <span ng-bind-html="task.name"></span> <small>{{task.id}}</small>
                            </span>
                            <span ng-if="!task.isSelected" ng-cloak>
                                <span ng-bind-html="task.name"></span> <small>{{task.id}}</small>
                            </span>
                        </div>
                        <div class="col-md-11" ng-if="!$first">
                            <span class="fa fa-tasks"></span>
                            <!-- have to use blur, because editable doesn't work with uib-tabs in any other way -->
                            <span ng-if="task.isSelected" ng-cloak editable-text="task.name"
                                  onbeforesave="saveTaskName($data)" buttons="no" blur="submit">
                                <span ng-bind-html="task.name"></span> <small>{{task.id}}</small>
                            </span>
                            <span ng-if="!task.isSelected" ng-cloak>
                                <span ng-bind-html="task.name"></span> <small>{{task.id}}</small>
                            </span>
                        </div>
                        <!-- TODO failed attempt to provide a preview of the goal -->
                        <!--<div class="col-md-3"  ng-if="selectedTask != task"><span class="fa fa-tasks k4-nowrap k4-abbreviate"> {{task.goalLabel}}</span></div>-->
                        <!--<div class="col-md-8" ng-if="selectedTask != task">-->
                            <!--<span class="k4-tiny k4-abbreviate k4-nowrap">-->
                                <!--<k4-formula formula="task.proofNode.sequent.ante[0].formula"-->
                                            <!--highlight="false"-->
                                            <!--collapsed="true"-->
                                            <!--ng-if="task.proofNode.sequent.ante.length > 0"></k4-formula>-->
                                <!--&#8866;-->
                                <!--<k4-formula formula="task.proofNode.sequent.succ[0].formula"-->
                                            <!--highlight="false"-->
                                            <!--collapsed="true"-->
                                            <!--ng-if="task.proofNode.sequent.succ.length > 0"></k4-formula>-->
                            <!--</span>-->
                        <!--</div>-->
                        <div class="col-md-1" cg-busy="defer" ng-if="defer"></div>
                    </div>
                </uib-tab-heading>

                <!-- ng-if: prevent compiling invisible (other) tabs, but recompiles every time tab is selected -->
                <div class="container" id="provingsequentview">
                    <k4-sequentproof user-id="userId"
                                 proof-id="proofId"
                                 node-id="task.id"
                                 deduction-path="task.deduction"
                                 proof-tree="prooftree"
                                 agenda="agenda"
                                 read-only="false"
                                 on-tactic="doTactic(formulaId, tacticId)"
                                 on-input-tactic="doInputTactic(formulaId, tacticId, input)"
                                 on-two-position-tactic="doTwoPositionTactic(fml1Id, fml2Id, tacticId)"
                                 ng-if="task.isSelected"></k4-sequentproof>
                </div>

                <!-- vertical gap between sequent and tactic editor to provide space for collapse/expand buttons -->
                <div style="margin-top:20px;"></div>

                <!-- Tactic -->
                <div class="row" id="provingtactics" ng-if="task.isSelected">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="col-md-2"><h3 class="panel-title k4-abbreviate"
                                                          uib-tooltip="Proof Programming" tooltip-placement="auto top"
                                                          tooltip-popup-delay="1000">Proof Programming</h3></div>
                                <div class="input-group col-md-10" ng-if="tactic.tacticDel === ''">
                                    <span class="input-group-btn"
                                          uib-tooltip="Rerun tactic from original conjecture"
                                          data-intro="Rerun the tactic from the start" data-position="right">
                                        <button class="btn btn-default" ng-click="rerunTactic()">Rerun</button>
                                    </span>
                                    <span class="input-group-addon">Fresh steps</span>
                                    <input type="text" class="form-control k4-abbreviate" placeholder="None"
                                           ng-shift-enter="executeTacticDiff(false)"
                                           uib-tooltip="Edit tactic below (augment proof with fresh steps by pressing 'shift-enter' or clicking 'Execute')"
                                           tooltip-placement="auto top-left" ng-model="tactic.tacticDiff">
                                    <span class="input-group-addon">Execute: </span>
                                    <span class="input-group-btn"
                                          uib-tooltip="Augment the derivation on the current tab with fresh steps (execute as one proof step)"
                                          tooltip-placement="auto top-left"
                                          data-intro="Run changes in the tactic as a single step." data-position="left">
                                        <button class="btn btn-default" ng-click="executeTacticDiff(false)"
                                                ng-disabled="tactic.tacticDiff == undefined || tactic.tacticDiff === ''">Atomic</button>
                                    </span>
                                    <span class="input-group-btn"
                                          uib-tooltip="Augment the derivation on the current tab with fresh steps (execute step-by-step)"
                                          tooltip-placement="auto top-left"
                                          data-intro="Run changes in the tactic step-by-step." data-position="left">
                                        <button class="btn btn-default" ng-click="executeTacticDiff(true)"
                                                ng-disabled="tactic.tacticDiff == undefined || tactic.tacticDiff === ''">Step-by-Step</button>
                                    </span>
                                </div>
                                <div class="input-group col-md-10" ng-if="tactic.tacticDel !== ''">
                                    <span class="input-group-btn"
                                          uib-tooltip="Rerun tactic from original conjecture"
                                          data-intro="Rerun the tactic from the start" data-position="right">
                                        <button class="btn btn-default" ng-click="rerunTactic()">Rerun</button>
                                    </span>
                                    <span class="input-group-addon">Replace {{tactic.tacticDel}} with </span>
                                    <input type="text" readonly class="form-control k4-abbreviate" placeholder="None"
                                           ng-shift-enter="executeTacticDiff(false)"
                                           uib-tooltip="Edit tactic below (augment proof with fresh steps by pressing 'shift-enter' or clicking 'Execute')"
                                           tooltip-placement="top-left" ng-model="tactic.tacticDiff">
                                    <span class="input-group-addon">Execute: </span>
                                    <span class="input-group-btn"
                                          uib-tooltip="Augment the derivation on the current tab with fresh steps (execute as one step)"
                                          tooltip-placement="auto top-left">
                                        <button class="btn btn-default" ng-click="executeTacticDiff(false)"
                                                ng-disabled="tactic.tacticDiff == undefined || tactic.tacticDiff === ''">Atomic</button>
                                    </span>
                                    <span class="input-group-btn"
                                          uib-tooltip="Augment the derivation on the current tab with fresh steps (execute step-by-step)"
                                          tooltip-placement="auto top-left">
                                        <button class="btn btn-default" ng-click="executeTacticDiff(true)"
                                                ng-disabled="tactic.tacticDiff == undefined || tactic.tacticDiff === ''">Step-by-Step</button>
                                    </span>
                                </div>
                            </div>
                            <div class="panel-body" data-intro="Clicks are recorded here. Append to automate proof steps instead of clicking. <dl class='dl-horizontal'><dt><code>s ; t</code></dt><dd>Run t after s</dd><dt><code>s | t</code></dt><dd>Run t if s fails</dd><dt><code>t*</code></dt><dd>Repeat t exhaustively</dd><dt><code>t*n</code></dt><dd>Run t n times</dd><dt><code>&lt;(t1,...tn)</code></dt><dd>Run ti on subgoal i</dd><dt><code>doall(t)</code></dt><dd>Run t on every subgoal</dd><dt>t(j)</dt><dd>Apply t at position j</dd><dt>1, 2, 3, ..., 'Rlast</dt><dd>Succedent positions</dd><dt>-1, -2, -3, ..., 'Llast</dt><dd>Antecedent positions</dd><dt>4.0.1</dt><dd>Subposition, second child of first child of succedent 4</dd><dt>'L, 'R</dt><dd>Search left/right for first applicable formula</dd></dl>" data-position="bottom">
                            <k4-tactic-editor user-id="userId" proof-id="proofId" node-id="task.id"
                                              on-tactic="doTactic(formulaId, tacticId)"
                                              on-tactic-script="onTacticScript(tacticText,stepwise)">
                            </k4-tactic-editor>
                            </div>
                        </div>
                        <!-- could have further tabs: e.g., graphical tactic editor -->
                    </div>
                </div>
            </uib-tab>
        </uib-tabset>
    </div>
</div>

</div>
</div>
</div>
</div>